# coding: utf-8

{{>partial_header}}

from __future__ import absolute_import

import time
from typing import Any, List, Dict
from loguru import logger

{{#operations}}
# noinspection Mypy,DuplicatedCode
class {{custom_classname}}(object):
    """NOTE: This class is auto generated by OpenAPI Generator
    Ref: https://openapi-generator.tech

    Do not edit the class manually.
    """
    IS_LIVE = False
    AWAITING_MESSAGES: List[Dict] = []

    def set_live(self):
        self.IS_LIVE = True
        from api.midi_app import send_message_to_script

        for message in self.AWAITING_MESSAGES:
            logger.info(f"sending awaiting message {message}")
            send_message_to_script(message)
        self.AWAITING_MESSAGES = []


{{#operation}}

    def {{operationId}}(self, {{#sortParamsByRequiredFlag}}{{#allParams}}{{#required}}{{paramName}}, {{/required}}{{/allParams}}{{/sortParamsByRequiredFlag}}{{#optionalParams}}{{paramName}}={{{defaultValue}}}{{^-last}}, {{/-last}}{{/optionalParams}}):  # noqa: E501
        # type: ({{#sortParamsByRequiredFlag}}{{#allParams}}{{#required}}{{dataType}}, {{/required}}{{/allParams}}{{/sortParamsByRequiredFlag}}Any) -> None
        """{{#summary}}{{{.}}}{{/summary}}{{^summary}}{{operationId}}{{/summary}}  # noqa: E501

{{#notes}}
        {{{notes}}}  # noqa: E501
{{/notes}}

{{#allParams}}
        :param {{paramName}}:{{#description}} {{{description}}}{{/description}}{{#required}} (required){{/required}}{{#optional}}(optional){{/optional}}
        :type {{paramName}}: {{dataType}}{{#optional}}, optional{{/optional}}
{{/allParams}}
        :rtype: {{#returnType}}{{returnType}}{{/returnType}}{{^returnType}}None{{/returnType}}
        """

        message = {
            "method": "{{operationId}}",
            "args": {
            {{#allParams}}"{{paramName}}": {{paramName}}, {{/allParams}}
            }
        }

        if not self.IS_LIVE:
            logger.info(f"client is not live, storing message {message}")
            self.AWAITING_MESSAGES.append(message)
            return

        from api.midi_app import send_message_to_script
        send_message_to_script(message)


{{/operation}}
{{/operations}}
